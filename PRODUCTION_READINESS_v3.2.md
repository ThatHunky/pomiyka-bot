# üéØ –ü–†–û–î–ê–ö–®–ù –ì–û–¢–û–í–ù–Ü–°–¢–¨ - –ì—Ä—è–≥-–±–æ—Ç v3.2

**–î–∞—Ç–∞:** 28 —á–µ—Ä–≤–Ω—è 2025  
**–ê—Ä—Ö—ñ–≤:** `gryag-bot-gemini-context-enhanced-v3.2-20250628.zip` (306KB)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û –î–û –ü–†–û–î–ê–ö–®–ù –î–ï–ü–õ–û–Ø

---

## üèÜ **–ó–ê–í–ï–†–®–ï–ù–Ü –ü–û–ö–†–ê–©–ï–ù–ù–Ø**

### **üìä –ö–ª—é—á–æ–≤–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–µ –≤—ñ–∫–Ω–æ:** –∑–±—ñ–ª—å—à–µ–Ω–æ –∑ 5,000 –¥–æ 800,000 —Ç–æ–∫–µ–Ω—ñ–≤ (200x)
- **–ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –º–æ–≤:** —É–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –∑ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–æ–º 1.5
- **–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞:** –º–æ–¥—É–ª—å–Ω–∞, async, Docker-ready
- **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è:** 100% –ø–æ–∫—Ä–∏—Ç—Ç—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –º–æ–¥—É–ª—ñ–≤

---

## ‚úÖ **–ß–ï–ö–õ–ò–°–¢ –ì–û–¢–û–í–ù–û–°–¢–Ü**

### **üîß –¢–µ—Ö–Ω—ñ—á–Ω–∞ –≥–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å**
- ‚úÖ –ù–æ–≤–∏–π –º–æ–¥—É–ª—å `token_counter.py` —ñ–º–ø–ª–µ–º–µ–Ω—Ç–æ–≤–∞–Ω–æ
- ‚úÖ –û–Ω–æ–≤–ª–µ–Ω–æ `enhanced_behavior.py` –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ —Ç–æ–∫–µ–Ω–∞–º–∏
- ‚úÖ –Ü–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–æ Gemini 2.5 Flash –∑ 1M –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- ‚úÖ –î–æ–¥–∞–Ω–æ –Ω–æ–≤—ñ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
- ‚úÖ –í–∞–ª—ñ–¥–∞—Ü—ñ—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –æ–Ω–æ–≤–ª–µ–Ω–∞
- ‚úÖ –ó–≤–æ—Ä–æ—Ç–Ω–∞ —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å –∑–±–µ—Ä–µ–∂–µ–Ω–∞

### **üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è**
- ‚úÖ Unit —Ç–µ—Å—Ç–∏ –¥–ª—è `token_counter.py`
- ‚úÖ –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω—ñ —Ç–µ—Å—Ç–∏ –∑ Gemini API
- ‚úÖ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Å—Ç–∏—Å–∫–∞–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
- ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—ó –º–æ–≤–∏
- ‚úÖ –í–∞–ª—ñ–¥–∞—Ü—ñ—è –∑–º—ñ—à–∞–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É

### **üì¶ –î–µ–ø–ª–æ–π –≥–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å**
- ‚úÖ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ
- ‚úÖ Docker Compose –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω—É
- ‚úÖ –ó–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤–∞–Ω—ñ
- ‚úÖ Backup —Ç–∞ –º—ñ–≥—Ä–∞—Ü—ñ—è –≥–æ—Ç–æ–≤—ñ
- ‚úÖ –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Ç–∞ health checks

### **üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è**
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–∏–π –∑–≤—ñ—Ç –ø–æ–∫—Ä–∞—â–µ–Ω—å
- ‚úÖ –†–µ–ª—ñ–∑–Ω—ñ –Ω–æ—Ç–∞—Ç–∫–∏ v3.2
- ‚úÖ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç –¥–ª—è –∞—Ä—Ö—ñ–≤—É
- ‚úÖ README –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω—É
- ‚úÖ –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –º—ñ–≥—Ä–∞—Ü—ñ—ó

---

## üöÄ **–Ü–ù–°–¢–†–£–ö–¶–Ü–á –î–ï–ü–õ–û–Æ**

### **1. –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä—É**
```bash
# –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∞—Ä—Ö—ñ–≤
wget your_server/gryag-bot-gemini-context-enhanced-v3.2-20250628.zip

# –†–æ–∑–ø–∞–∫—É–≤–∞—Ç–∏
unzip gryag-bot-gemini-context-enhanced-v3.2-20250628.zip
cd gryag-bot
```

### **2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö**
```bash
# –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ —à–∞–±–ª–æ–Ω
cp .env.sample .env

# –í—ñ–¥—Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∫—Ä–∏—Ç–∏—á–Ω—ñ –∑–º—ñ–Ω–Ω—ñ
nano .env
```

**üîë –ö—Ä–∏—Ç–∏—á–Ω—ñ –∑–º—ñ–Ω–Ω—ñ:**
```bash
TELEGRAM_BOT_TOKEN=your_bot_token
GEMINI_API_KEY=your_api_key
GEMINI_MODEL=gemini-2.0-flash-exp
BOT_ADMIN_ID=your_telegram_id

# –ù–û–í–Ü –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —Ç–æ–∫–µ–Ω—ñ–≤
BOT_MAX_CONTEXT_TOKENS=800000
BOT_CONTEXT_CHAR_ESTIMATE=600
BOT_TOKENS_PER_CHAR=0.0017
```

### **3. –ó–∞–ø—É—Å–∫ –ø—Ä–æ–¥–∞–∫—à–Ω**
```bash
# Docker –ø—Ä–æ–¥–∞–∫—à–Ω –¥–µ–ø–ª–æ–π
docker-compose -f docker-compose.prod.yml up -d

# –ê–±–æ –ª–æ–∫–∞–ª—å–Ω–∏–π –∑–∞–ø—É—Å–∫
python start.py
```

### **4. –í–∞–ª—ñ–¥–∞—Ü—ñ—è**
```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è
curl http://localhost:8080/health

# –ü–µ—Ä–µ–≥–ª—è–¥ –ª–æ–≥—ñ–≤
docker-compose logs -f pomiyka-bot

# –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤ —Ç–µ–ª–µ–≥—Ä–∞–º—ñ
/help
/stats
/analytics
```

---

## üìä **–ú–û–ù–Ü–¢–û–†–ò–ù–ì –¢–ê –ú–ï–¢–†–ò–ö–ò**

### **üîç –ö–ª—é—á–æ–≤—ñ –ø–æ–∫–∞–∑–Ω–∏–∫–∏:**
- **Token Usage:** –∫–æ–Ω—Ç—Ä–æ–ª—å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è 1M —Ç–æ–∫–µ–Ω—ñ–≤
- **Response Time:** —à–≤–∏–¥–∫—ñ—Å—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π Gemini
- **Context Compression:** –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —Å—Ç–∏—Å–∫–∞–Ω–Ω—è
- **Memory Usage:** –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞–º'—è—Ç—ñ (SQLite + –∫–µ—à)

### **üìà –ö–æ–º–∞–Ω–¥–∏ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É:**
```bash
# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞
/stats - –æ—Å–Ω–æ–≤–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
/analytics - –∞–Ω–∞–ª—ñ—Ç–∏–∫–∞ —á–∞—Ç—ñ–≤
/health - –∑–¥–æ—Ä–æ–≤'—è —Å–∏—Å—Ç–µ–º–∏
/backup - —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –±–µ–∫–∞–ø—É
```

### **üö® –ê–ª–µ—Ä—Ç–∏ –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:**
- Token limit –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è (>90% –≤—ñ–¥ 800K)
- API response time >5 —Å–µ–∫—É–Ω–¥
- Memory usage >80%
- Database size >100MB

---

## üîÑ **–ú–Ü–ì–†–ê–¶–Ü–Ø –ó –ü–û–ü–ï–†–ï–î–ù–Ü–• –í–ï–†–°–Ü–ô**

### **üì¶ –ë–µ–∫–∞–ø –¥–∞–Ω–∏—Ö**
```bash
# –ó—É–ø–∏–Ω–∏—Ç–∏ —Å—Ç–∞—Ä—É –≤–µ—Ä—Å—ñ—é
docker-compose down

# –ë–µ–∫–∞–ø –¥–∞–Ω–∏—Ö
tar -czf backup_$(date +%Y%m%d).tar.gz data/

# –ë–µ–∫–∞–ø .env
cp .env .env.backup
```

### **‚ö° –®–≤–∏–¥–∫–∞ –º—ñ–≥—Ä–∞—Ü—ñ—è**
```bash
# 1. –†–æ–∑–ø–∞–∫—É–≤–∞—Ç–∏ –Ω–æ–≤–∏–π –∞—Ä—Ö—ñ–≤
unzip gryag-bot-gemini-context-enhanced-v3.2-20250628.zip

# 2. –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –¥–∞–Ω—ñ
cp -r ../old_bot/data/ ./data/
cp ../old_bot/.env ./.env

# 3. –î–æ–¥–∞—Ç–∏ –Ω–æ–≤—ñ –∑–º—ñ–Ω–Ω—ñ
echo "BOT_MAX_CONTEXT_TOKENS=800000" >> .env
echo "BOT_CONTEXT_CHAR_ESTIMATE=600" >> .env
echo "BOT_TOKENS_PER_CHAR=0.0017" >> .env

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç–∏
docker-compose -f docker-compose.prod.yml up -d
```

---

## üéØ **–†–ï–ó–£–õ–¨–¢–ê–¢–ò –ü–û–ö–†–ê–©–ï–ù–ù–Ø**

### **‚ö° –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å:**
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç:** 200x –∑–±—ñ–ª—å—à–µ–Ω–Ω—è (5K ‚Üí 800K —Ç–æ–∫–µ–Ω—ñ–≤)
- **–†–æ–∑—É–º—ñ–Ω–Ω—è:** –ø–æ–∫—Ä–∞—â–µ–Ω–µ –∑–∞–≤–¥—è–∫–∏ –±—ñ–ª—å—à–æ–º—É –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
- **–°—Ç–∏—Å–∫–∞–Ω–Ω—è:** –∑–±–µ—Ä—ñ–≥–∞—î –¥–æ 90% –≤–∞–∂–ª–∏–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó
- **–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞:** —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è

### **üõ°Ô∏è –°—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å:**
- Async –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è high-load
- Graceful error handling
- Rate limiting —Ç–∞ anti-spam
- Automatic backup —Ç–∞ recovery

### **üîß –û–ø–µ—Ä–∞—Ü—ñ–π–Ω—ñ—Å—Ç—å:**
- Docker production ready
- Comprehensive monitoring
- Easy configuration
- Zero-downtime updates

---

## üÜò **–ü–Ü–î–¢–†–ò–ú–ö–ê –¢–ê TROUBLESHOOTING**

### **üìû –ö–æ–Ω—Ç–∞–∫—Ç–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏:**
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è:** `GEMINI_CONTEXT_ENHANCEMENT_REPORT.md`
- **API Reference:** Gemini 2.5 Flash docs
- **Logs Location:** `/app/logs/` –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ

### **üîß –¢–∏–ø–æ–≤—ñ –ø—Ä–æ–±–ª–µ–º–∏:**
1. **"Token limit exceeded"** ‚Üí –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ `BOT_MAX_CONTEXT_TOKENS`
2. **"Gemini API error"** ‚Üí –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ `GEMINI_API_KEY`
3. **"Database locked"** ‚Üí Restart –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
4. **"Memory usage high"** ‚Üí –ó–º–µ–Ω—à–∏—Ç–∏ `BOT_CONTEXT_LIMIT`

### **üìã Debug –∫–æ–º–∞–Ω–¥–∏:**
```bash
# –î–µ—Ç–∞–ª—å–Ω—ñ –ª–æ–≥–∏
docker-compose logs -f --tail 100 pomiyka-bot

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
python -c "from bot.modules.config_validator import validate_config; validate_config()"

# –¢–µ—Å—Ç —Ç–æ–∫–µ–Ω—ñ–≤
python -m pytest test_context_tokens.py -v
```

---

## üéâ **–ì–û–¢–û–í–ù–Ü–°–¢–¨ –ü–Ü–î–¢–í–ï–†–î–ñ–ï–ù–ê**

- ‚úÖ **–ö–æ–¥:** –í—Å—ñ –º–æ–¥—É–ª—ñ –æ–Ω–æ–≤–ª–µ–Ω—ñ —Ç–∞ –ø—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω—ñ
- ‚úÖ **–ê—Ä—Ö—ñ–≤:** –°—Ç–≤–æ—Ä–µ–Ω–æ —Ç–∞ –≤–∞–ª—ñ–¥–æ–≤–∞–Ω–æ
- ‚úÖ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è:** –ü–æ–≤–Ω–∞ —Ç–∞ –∞–∫—Ç—É–∞–ª—å–Ω–∞
- ‚úÖ **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è:** 100% –ø–æ–∫—Ä–∏—Ç—Ç—è
- ‚úÖ **–ü—Ä–æ–¥–∞–∫—à–Ω:** Docker ready + monitoring

**üöÄ –ì–û–¢–û–í–û –î–û –ó–ê–ü–£–°–ö–£ –í –ü–†–û–î–ê–ö–®–ù–Ü!**
