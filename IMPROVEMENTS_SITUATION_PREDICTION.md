# Покращення системи передбачення ситуацій в чаті

## Що було додано

### 1. Новий модуль `enhanced_behavior.py`

Цей модуль включає розумний аналіз контексту розмов та передбачення ситуацій, як показано на вашому скріні. Основні можливості:

#### Аналіз типів розмов:
- **Технічні дискусії** (код, алгоритми, дебаг)
- **Філософські розмови** (сенс життя, мораль)
- **Жарти та меми** (гумор, приколи)
- **Емоційні розмови** (почуття, настрої)
- **Побутові теми** (їжа, робота, погода)
- **Конфлікти** (суперечки, негатив)

#### Аналіз настрою:
- **Позитивний** (радість, захоплення)
- **Негативний** (сум, злість)
- **Нейтральний** (задумливість)
- **Енергійний** (збудження, активність)

#### Розумні рішення про відповіді:
- Рівень залученості бота (1-10)
- Рекомендований тон відповіді
- Чи варто втрутитися в розмову

### 2. Контекстно-свідомі промти

Бот тепер генерує промти для Gemini з урахуванням:
- Типу поточної розмови
- Настрою учасників
- Трендів чату за останні години
- Рівня необхідної залученості

### 3. Покращена спонтанна активність

Бот аналізує тренди чату та:
- Втручається при довгій тиші для оживлення
- Піднімає настрій при негативних трендах
- Адаптує стиль до контексту розмови

### 4. Аналітика чатів

Нова команда `/analytics` показує:
- Рівень активності за 24 години
- Тенденції настрою
- Популярні теми обговорення
- Середню залученість бота

## Як це допомагає з ситуаціями як на скріні

На вашому скріні видно складну розмову між користувачами з різними темами:

1. **Всеволод** говорить про фізичні відчуття та філософствує
2. **Артем** обговорює колекцію помилок та технічні аспекти

### Раніше бот міг:
- Випадково відповісти на згадку свого імені
- Надіслати спонтанне повідомлення

### Тепер бот:

1. **Аналізує контекст**: розпізнає що Всеволод філософствує, а Артем говорить про технічні речі
2. **Визначає настрій**: Всеволод - задумливо-філософський, Артем - технічно-нейтральний
3. **Розраховує залученість**: високий рівень через згадки імені та цікаві теми
4. **Вибирає тон**: "глибокий_абсурд" для філософської частини або "розумний_абсурд" для технічної
5. **Генерує промт**: створює спеціальний промт для Gemini з урахуванням всього контексту
6. **Відповідає релевантно**: дає відповідь, що підходить і до філософії, і до технічних тем

## Приклад роботи

### Ситуація з скріну:
```
Всеволод: "блять не спам блять, що таке болить щойно розущена павутина..."
Артем: "Гряг не малює того що можна побачити..."
```

### Аналіз бота:
- **Тип**: змішаний (філософське + згадка бота)
- **Настрій**: задумливий + звернення
- **Залученість**: 8/10 (пряма згадка + цікавий контекст)
- **Тон**: глибокий_абсурд

### Промт для Gemini:
```
Ти — Гряг, абсурдний дух чату з дотепним гумором.

Ситуація:
- Тип розмови: філософське
- Настрій: задумливий  
- Рівень залученості: 8/10
- Рекомендований тон: глибокий_абсурд

Повідомлення: "Гряг не малює того що можна побачити..."

Інструкція: Філософствуй абсурдно, ставй дивні питання та роби несподівані зв'язки.

Відповідай коротко (1-2 речення), дотепно та по-українськи.
```

## Налаштування

Нові параметри в `.env`:
```
# Розумна поведінка (за замовчуванням)
BOT_SMART_REPLY_CHANCE=0.1
BOT_SPONTANEOUS_CHANCE=0.02
BOT_REACTION_CHANCE=0.05

# Додаткові тригери
BOT_TRIGGER_KEYWORDS=гряг,@gryag_bot,грягік,бот,боте
```

## Команди адміністратора

- `/analytics` - показує аналітику чату за 24 години
- `/stats` - загальна статистика бота
- `/help` - список всіх команд

## Технічні переваги

1. **Передбачуваність**: бот аналізує патерни та може передбачити розвиток розмови
2. **Адаптивність**: стиль відповіді адаптується до контексту
3. **Ефективність**: менше непотрібних відповідей, більше релевантних
4. **Аналітика**: можливість моніторити та покращувати роботу

Цей підхід дозволяє боту бути більш розумним та контекстно-свідомим, що робить його взаємодії природнішими та цікавішими.
