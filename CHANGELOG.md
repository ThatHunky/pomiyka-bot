# üìã –Ü—Å—Ç–æ—Ä—ñ—è –∑–º—ñ–Ω –ì—Ä—è–≥-–±–æ—Ç–∞

## v2.4 - –ü–æ–∫—Ä–∞—â–µ–Ω–∏–π error handling —Ç–∞ rate limiting (26.06.2025)

### ‚úÖ –î–æ–¥–∞–Ω–æ
- **Rate limiting —Å–∏—Å—Ç–µ–º–∞** üõ°Ô∏è
  - –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ flood control Telegram
  - –õ—ñ–º—ñ—Ç 3 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è/—Ö–≤–∏–ª–∏–Ω—É –Ω–∞ —á–∞—Ç, 20/—Ö–≤–∏–ª–∏–Ω—É –≥–ª–æ–±–∞–ª—å–Ω–æ
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫ —Ç–∞ –ø—Ä–∏—Ç–ª—É–º–ª–µ–Ω–Ω—è —Å–ø–∞–º—É
  - –ù–∞–ª–∞—à—Ç–æ–≤—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ `BOT_RATE_LIMIT_PER_CHAT`, `BOT_GLOBAL_RATE_LIMIT`
- **–†–æ–∑—É–º–Ω–∏–π error handling** üîß
  - –ë–µ–∑–ø–µ—á–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó `safe_reply()` —Ç–∞ `safe_send_message()`
  - –û–±—Ä–æ–±–∫–∞ `TelegramRetryAfter` —Ç–∞ `TelegramBadRequest`
  - –ó–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –∫–∞—Å–∫–∞–¥–Ω–∏–º –ø–æ–º–∏–ª–∫–∞–º –≤ error handler
  - –°–µ–ª–µ–∫—Ç–∏–≤–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–∞ –ø–æ–º–∏–ª–∫–∏ (`BOT_ERROR_REPLY_CHANCE`)

### üîÑ –ó–º—ñ–Ω–µ–Ω–æ
- **–í—Å—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å** —Ç–µ–ø–µ—Ä –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –±–µ–∑–ø–µ—á–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
- **Error handler** –Ω–µ —Å—Ç–≤–æ—Ä—é—î –Ω–æ–≤—ñ –ø–æ–º–∏–ª–∫–∏ –ø—Ä–∏ –∑–±–æ—è—Ö
- **–°–ø–æ–Ω—Ç–∞–Ω–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è** —Ç–∞–∫–æ–∂ –∑–∞—Ö–∏—â–µ–Ω—ñ rate limiting
- **–õ–æ–≥—É–≤–∞–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫** –ø–æ–∫—Ä–∞—â–µ–Ω–æ –∑ –¥–æ–¥–∞—Ç–∫–æ–≤–∏–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

### üêõ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ
- **–ü—Ä–æ–±–ª–µ–º–∞ –∑ —Ñ–ª—É–¥–æ–º** –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É - –ø–æ–≤–Ω—ñ—Å—Ç—é –≤–∏—Ä—ñ—à–µ–Ω–∞
- **–ö–∞—Å–∫–∞–¥–Ω—ñ –ø–æ–º–∏–ª–∫–∏** –ø—Ä–∏ "message to be replied not found"
- **Flood control exceeded** –±—ñ–ª—å—à–µ –Ω–µ —Å—Ç–≤–æ—Ä—é—î –ª–∞–Ω—Ü—é–∂–∫–∏ –ø–æ–º–∏–ª–æ–∫
- **–°—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å —Ä–æ–±–æ—Ç–∏** –∑–Ω–∞—á–Ω–æ –ø–æ–∫—Ä–∞—â–µ–Ω–∞

## v2.3 - –Ü–≥–Ω–æ—Ä—É–≤–∞–Ω–Ω—è —Å—Ç–∞—Ä–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å (26.06.2025)

### ‚úÖ –î–æ–¥–∞–Ω–æ
- **–ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ —Å–ø–∞–º—É –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É** üõ°Ô∏è
  - –ë–æ—Ç —ñ–≥–Ω–æ—Ä—É—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —Å—Ç–∞—Ä—à–µ 10 —Ö–≤–∏–ª–∏–Ω –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É
  - –ó–∞–ø–æ–±—ñ–≥–∞—î –º–∞—Å–æ–≤—ñ–π –æ–±—Ä–æ–±—Ü—ñ –Ω–∞–∫–æ–ø–∏—á–µ–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
  - –ù–∞–ª–∞—à—Ç–æ–≤—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ `BOT_IGNORE_OLD_MESSAGES` —Ç–∞ `BOT_MAX_MESSAGE_AGE_MINUTES`

### üîÑ –ó–º—ñ–Ω–µ–Ω–æ
- **–ü–æ–∫—Ä–∞—â–µ–Ω–∞ –ª–æ–≥—ñ–∫–∞ –∑–∞–ø—É—Å–∫—É**:
  - –î–æ–¥–∞–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–∫—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –Ω–∞ –ø–æ—á–∞—Ç–∫—É –æ–±—Ä–æ–±–∫–∏
  - –õ–æ–≥—É–≤–∞–Ω–Ω—è —ñ–≥–Ω–æ—Ä–æ–≤–∞–Ω–∏—Ö —Å—Ç–∞—Ä–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
- **–û–Ω–æ–≤–ª–µ–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è**:
  - –ù–æ–≤—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —É `.env.example`
  - –ü–æ–∫—Ä–∞—â–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è —É README.md

## v2.2 - –°–ø–æ–Ω—Ç–∞–Ω–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è + –∞–≥—Ä–µ—Å–∏–≤–Ω–∏–π –∞–Ω—Ç–∏-—Å–ø–∞–º (26.06.2025)

### ‚úÖ –î–æ–¥–∞–Ω–æ
- **–°–ø–æ–Ω—Ç–∞–Ω–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è** üí≠
  - –ë–æ—Ç –ø–∏—à–µ —á–∞—Å –≤—ñ–¥ —á–∞—Å—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–µ —É –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ —â–æ—Å—å
  - –§–æ–Ω–æ–≤–∞ –∑–∞–¥–∞—á–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—î –∫–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω —á–∏ –ø–æ—Ç—Ä—ñ–±–Ω–∞ —Å–ø–æ–Ω—Ç–∞–Ω–Ω–∞ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å
  - –ó–±—ñ–ª—å—à–µ–Ω–∏–π —à–∞–Ω—Å –ø—ñ—Å–ª—è –¥–æ–≤–≥–æ—ó —Ç–∏—à—ñ (1-2 –≥–æ–¥–∏–Ω–∏)
  - –†—ñ–∑–Ω—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ –ø—Ä–æ–º–ø—Ç—ñ–≤ –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –Ω–∞—Å—Ç—Ä–æ—é —á–∞—Ç—É
  - –ù–∞–ª–∞—à—Ç–æ–≤—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ `BOT_SPONTANEOUS_CHANCE` —Ç–∞ `BOT_SPONTANEOUS_MIN_PAUSE`
- **–ê–≥—Ä–µ—Å–∏–≤–Ω–∏–π –∞–Ω—Ç–∏-—Å–ø–∞–º —Ç—Ä–æ—Ç—Ç–ª—ñ–Ω–≥** üõë
  - –í—ñ–¥—Å—Ç–µ–∂—É—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑–∞ —Ö–≤–∏–ª–∏–Ω—É
  - –ü—Ä–∏ —Å–ø–∞–º—ñ —ñ–≥–Ω–æ—Ä—É—î –∞–±–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Ñ—Ä–∞–∑–∞–º–∏ —Ç–∏–ø—É "—Ç—ñ—Ö–∞ –±–ª—è—Ç—å, —Ö–æ—Ö–ª–∏"
  - –¢–∞–π–º–∞—É—Ç –Ω–∞ 5 —Ö–≤–∏–ª–∏–Ω –¥–ª—è –≤—Å—å–æ–≥–æ —á–∞—Ç—É –ø—Ä–∏ –≤–∏—è–≤–ª–µ–Ω–Ω—ñ —Å–ø–∞–º—É
  - –ù–∞–ª–∞—à—Ç–æ–≤—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ `BOT_SPAM_THRESHOLD`, `BOT_SPAM_TIMEOUT`, `BOT_SPAM_REPLIES`

### üîÑ –ó–º—ñ–Ω–µ–Ω–æ
- **–ü–æ–∫—Ä–∞—â–µ–Ω–∞ —Å–ø–æ–Ω—Ç–∞–Ω–Ω–∞ –ª–æ–≥—ñ–∫–∞**:
  - –ë—ñ–ª—å—à —Ä–æ–∑—É–º–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —á–∞—Å—É –¥–ª—è —Å–ø–æ–Ω—Ç–∞–Ω–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
  - –í—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —á–∞—Ç—É —Ç–∞ –Ω–∞—Å—Ç—Ä–æ—é
  - –†—ñ–∑–Ω—ñ –ø—Ä–æ–º–ø—Ç–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Å–∏—Ç—É–∞—Ü—ñ–π (—Ç–∏—à–∞, –≤–µ—Å–µ–ª–æ—â—ñ, —Å–≤–∞—Ä–∫–∏)
- **–û–Ω–æ–≤–ª–µ–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤ `.env.example`**:
  - –î–æ–¥–∞–Ω–æ –Ω–æ–≤—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –¥–ª—è —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ—ó –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
  - –î–æ–¥–∞–Ω–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –¥–ª—è –∞–≥—Ä–µ—Å–∏–≤–Ω–æ–≥–æ –∞–Ω—Ç–∏-—Å–ø–∞–º—É
  - –ü–æ–∫—Ä–∞—â–µ–Ω—ñ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ —Ç–∞ –ø–æ—è—Å–Ω–µ–Ω–Ω—è

### üêõ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ
- –ü–æ–∫—Ä–∞—â–µ–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ —É —Ñ–æ–Ω–æ–≤–∏—Ö –∑–∞–¥–∞—á–∞—Ö
- –ö—Ä–∞—â–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

## v2.1 - –î–æ–¥–∞–Ω–æ —Ä–µ–∞–∫—Ü—ñ—ó + –ø–æ–∫—Ä–∞—â–µ–Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—ñ—è (26.06.2025)

### ‚úÖ –î–æ–¥–∞–Ω–æ
- **–ï–º–æ–¥–∂—ñ-—Ä–µ–∞–∫—Ü—ñ—ó –Ω–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è** üé≠
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ —Ä–µ–∞–∫—Ü—ñ—ó –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
  - 70% —à–∞–Ω—Å –Ω–∞ –∑–≥–∞–¥–∫–∏ –±–æ—Ç–∞, 30% –Ω–∞ –ø–∏—Ç–∞–Ω–Ω—è, 5% –Ω–∞ –∑–≤–∏—á–∞–π–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
  - 30+ —Ä—ñ–∑–Ω–∏—Ö –µ–º–æ–¥–∂—ñ: –ø–æ–∑–∏—Ç–∏–≤–Ω—ñ, –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ñ, –∞–±—Å—É—Ä–¥–Ω—ñ
  - –ù–∞–ª–∞—à—Ç–æ–≤—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ `BOT_REACTION_CHANCE` —Ç–∞ `BOT_REACTION_ON_MENTIONS`
- **–ö–æ–º–∞–Ω–¥–∞ `/reactions`** - –ø–æ–∫–∞–∑—É—î –≤—Å—ñ –¥–æ—Å—Ç—É–ø–Ω—ñ —Ä–µ–∞–∫—Ü—ñ—ó –±–æ—Ç–∞

### üîÑ –ó–º—ñ–Ω–µ–Ω–æ
- **–ü–æ–∫—Ä–∞—â–µ–Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—ñ—è –±–æ—Ç–∞**:
  - –ú–µ–Ω—à –±–æ–∂–µ–≤—ñ–ª—å–Ω–∞, –±—ñ–ª—å—à –¥—Ä—É–∂–µ–ª—é–±–Ω–∞
  - –ó–∞–ª–∏—à–∏–≤—Å—è –ª–µ–≥–∫–∏–π –∞–±—Å—É—Ä–¥–Ω–∏–π –≥—É–º–æ—Ä, –∞–ª–µ –∑—Ä–æ–∑—É–º—ñ–ª—ñ—à–∏–π
  - –ö–º—ñ—Ç–ª–∏–≤–∏–π —Ç–∞ –ø—ñ–¥—Ç—Ä–∏–º—É—é—á–∏–π —Å—Ç–∏–ª—å —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è
- **–û–Ω–æ–≤–ª–µ–Ω—ñ —Ä–∞–Ω–¥–æ–º–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ** - —Ç–µ–ø–µ—Ä –±—ñ–ª—å—à –ø—Ä–∏—î–º–Ω—ñ —Ç–∞ –¥—Ä—É–∂–µ–ª—é–±–Ω—ñ
- **–ü–µ—Ä—Å–æ–Ω–∞–ª—ñ—è –¥–ª—è –∞–¥–º—ñ–Ω-–∫–æ–º–∞–Ω–¥** - –≤–µ—Å–µ–ª–∏–π, –∞–ª–µ –∑—Ä–æ–∑—É–º—ñ–ª–∏–π —Å—Ç–∏–ª—å

### üõ† –¢–µ—Ö–Ω—ñ—á–Ω—ñ –∑–º—ñ–Ω–∏
- –ù–æ–≤–∏–π –º–æ–¥—É–ª—å `reactions.py` –∑ –ª–æ–≥—ñ–∫–æ—é —Ä–µ–∞–∫—Ü—ñ–π
- –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è —Ä–µ–∞–∫—Ü—ñ–π —É –≥–æ–ª–æ–≤–Ω–∏–π —Ü–∏–∫–ª –æ–±—Ä–æ–±–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
- –û–Ω–æ–≤–ª–µ–Ω–æ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é —Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é

---

## v2.0 - –î—Ä—É–∂–µ–ª—é–±–Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—ñ—è + –∫–æ–º–∞–Ω–¥–∞ /rescan

### ‚úÖ –î–æ–¥–∞–Ω–æ
- **–ö–æ–º–∞–Ω–¥–∞ `/rescan`** - –ø—Ä–∏–º—É—Å–æ–≤–µ –ø–æ–≤—Ç–æ—Ä–Ω–µ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó —á–∞—Ç—É
  - –ö–æ—Ä–∏—Å–Ω–æ, —è–∫—â–æ –±–æ—Ç –±—É–≤ –¥–æ–¥–∞–Ω–∏–π –±–µ–∑ –¥–æ—Å—Ç—É–ø—É –¥–æ —ñ—Å—Ç–æ—Ä—ñ—ó –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
  - –°–∫–∏–¥–∞—î —Å—Ç–∞–Ω —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è —Ç–∞ –∑–∞–ø—É—Å–∫–∞—î –ø—Ä–æ—Ü–µ—Å –∑–∞–Ω–æ–≤–æ
  - –î–æ—Å—Ç—É–ø–Ω–∞ –ª–∏—à–µ –≤ –≥—Ä—É–ø–æ–≤–∏—Ö —á–∞—Ç–∞—Ö

### üõ† –¢–µ—Ö–Ω—ñ—á–Ω—ñ –∑–º—ñ–Ω–∏
- –î–æ–¥–∞–Ω–æ —Ñ—É–Ω–∫—Ü—ñ—é `reset_chat_scan_state()` –≤ `chat_scanner.py`
- –ì–ª–æ–±–∞–ª—å–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –±–æ—Ç–∞ –≤ `main.py` –¥–ª—è –∫–æ–º–∞–Ω–¥–∏ `/rescan`
- –û–Ω–æ–≤–ª–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é —Ç–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó

---

## v1.0 - –ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Ä–µ–ª—ñ–∑

### ‚úÖ –ë–∞–∑–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
- –ú–æ–¥—É–ª—å–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞
- –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Gemini 2.5 Flash
- SQLite –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è —á–∞—Ç—ñ–≤
- –ê–Ω—Ç–∏-—Å–ø–∞–º —Å–∏—Å—Ç–µ–º–∞
- Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü—ñ—è
- –Ü–º–ø–æ—Ä—Ç —ñ—Å—Ç–æ—Ä—ñ—ó –∑ Telegram Desktop
