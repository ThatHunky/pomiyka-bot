# –ó–≤—ñ—Ç –ø—Ä–æ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –æ–±—Ä–æ–±–∫–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É —á–∞—Ç—É

## –í–∏–∫–æ–Ω–∞–Ω–æ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è

### ‚úÖ –†–æ–∑—É–º–Ω–∞ –æ–±—Ä–æ–±–∫–∞ —Å–ø–∞–º—É
- **–§—É–Ω–∫—Ü—ñ—è**: `analyze_chat_spam_level()` –≤–∏—è–≤–ª—è—î —Ä—ñ–≤–Ω—ñ —Å–ø–∞–º—É (low/medium/high)
- **–ê–ª–≥–æ—Ä–∏—Ç–º**: –ê–Ω–∞–ª—ñ–∑—É—î —á–∞—Å—Ç–æ—Ç—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å (5 —Ö–≤–∏–ª–∏–Ω) —Ç–∞ –ø–æ–≤—Ç–æ—Ä—é–≤–∞–Ω—ñ—Å—Ç—å
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–º–µ–Ω—à—É—î –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –±–æ—Ç–∞ –ø—Ä–∏ —Å–ø–∞–º—ñ

### ‚úÖ –†–æ–∑—É–º–Ω–µ —Å—Ç–∏—Å–Ω–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É  
- **–§—É–Ω–∫—Ü—ñ—è**: `compress_context_smartly()` –∑–±–µ—Ä—ñ–≥–∞—î –Ω–∞–π–≤–∞–∂–ª–∏–≤—ñ—à—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∏**: –ó–≥–∞–¥–∫–∏ –±–æ—Ç–∞ ‚Üí –ü–∏—Ç–∞–Ω–Ω—è ‚Üí –î–æ–≤–≥—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è ‚Üí –ù–∞–π–Ω–æ–≤—ñ—à—ñ
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ö–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–≤–∂–¥–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É –±–µ–∑ –≤—Ç—Ä–∞—Ç–∏ –≤–∞–∂–ª–∏–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó

### ‚úÖ –ê–Ω–∞–ª—ñ–∑ —è–∫–æ—Å—Ç—ñ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
- **–§—É–Ω–∫—Ü—ñ—è**: `analyze_context_quality()` –æ—Ü—ñ–Ω—é—î –∫–æ–≥–µ—Ä–µ–Ω—Ç–Ω—ñ—Å—Ç—å —Ä–æ–∑–º–æ–≤–∏
- **–ö—Ä–∏—Ç–µ—Ä—ñ—ó**: –°—Ö–æ–∂—ñ—Å—Ç—å —Ç–µ–º, —Ä–æ–∑–±–∏—Ç—ñ—Å—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ë–æ—Ç –∞–¥–∞–ø—Ç—É—î —Å—Ç–∏–ª—å –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —è–∫–æ—Å—Ç—ñ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É

### ‚úÖ –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π
- **–°–ø–∞–º**: `minimal`/`concise` —Å—Ç–∏–ª—å, –æ–±–º–µ–∂–µ–Ω–Ω—è –¥–æ–≤–∂–∏–Ω–∏
- **–ü–æ–≥–∞–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç**: —Ñ–ª–∞–≥–∏ `should_ask_clarification` —Ç–∞ `should_provide_guidance`  
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: Gemini –æ—Ç—Ä–∏–º—É—î —Ç–æ—á–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–ª—è –∫–æ–∂–Ω–æ—ó —Å–∏—Ç—É–∞—Ü—ñ—ó

### ‚úÖ –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ –æ—Å–Ω–æ–≤–Ω–∏–º –±–æ—Ç–æ–º
- **–ú–æ–¥—É–ª—å**: `main.py` –æ–Ω–æ–≤–ª–µ–Ω–æ –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `process_message_with_smart_context()`
- **FakeMessage**: –†–æ–∑—à–∏—Ä–µ–Ω–æ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á—ñ –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö
- **Gemini**: –û–Ω–æ–≤–ª–µ–Ω–æ –¥–ª—è –æ–±—Ä–æ–±–∫–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π —Ç–∞ —Å—Ç–∏—Å–Ω–µ–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É

## –ù–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó

### –ì–æ–ª–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è
```python
from bot.modules.enhanced_behavior import process_message_with_smart_context

result = process_message_with_smart_context(
    message_text, chat_id, context, recent_messages
)
```

**–ü–æ–≤–µ—Ä—Ç–∞—î**:
- `should_respond` - —á–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—Ç–∏
- `spam_analysis` - —Ä—ñ–≤–µ–Ω—å —Å–ø–∞–º—É —Ç–∞ –∫–æ—Ä–µ–∫—Ü—ñ—ó
- `context_quality` - —è–∫—ñ—Å—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
- `tone_instruction` - –≥–æ—Ç–æ–≤–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –¥–ª—è Gemini
- `recommendations` - —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó —â–æ–¥–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
- `processed_context` - —Å—Ç–∏—Å–Ω–µ–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç

### –ê–Ω—Ç–∏-—Å–ø–∞–º –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
```python
anti_spam_msg = get_anti_spam_message(spam_level)
```

**–ü—Ä–∏–∫–ª–∞–¥–∏**:
- High: "–û–π, —Ç—É—Ç —Ç—Ä–æ—Ö–∏ –±–∞–≥–∞—Ç–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ! –î–∞–≤–∞–π—Ç–µ –ø—Ä–∏—Ç–∏—Ö–Ω–µ–º–æ –Ω–∞ —Ö–≤–∏–ª–∏–Ω–∫—É ü§´"
- Medium: "–û–≥–æ, —è–∫ –∞–∫—Ç–∏–≤–Ω–æ! üî•"

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥
```python
stats = get_processing_statistics(chat_id)
# –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –∑–∞ –≥–æ–¥–∏–Ω—É, –∑–∞–ø–∏—Å—ñ–≤ –∞–Ω–∞–ª—ñ–∑—É, —Ç–æ—â–æ
```

## –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–æ–±–æ—Ç–∏

### 1. –û–±—Ä–æ–±–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
```
–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è ‚Üí –ê–Ω–∞–ª—ñ–∑ —Å–ø–∞–º—É ‚Üí –°—Ç–∏—Å–Ω–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É ‚Üí 
–ê–Ω–∞–ª—ñ–∑ —è–∫–æ—Å—Ç—ñ ‚Üí –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π ‚Üí –§–æ—Ä–º—É–≤–∞–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
```

### 2. –ê–¥–∞–ø—Ç–∞—Ü—ñ—è –¥–æ —Å–∏—Ç—É–∞—Ü—ñ—ó

**–ù–æ—Ä–º–∞–ª—å–Ω–∞ —Å–∏—Ç—É–∞—Ü—ñ—è**:
- –ó–≤–∏—á–∞–π–Ω–∞ –¥–æ–≤–∂–∏–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ (200 —Å–∏–º–≤–æ–ª—ñ–≤)
- –ù–æ—Ä–º–∞–ª—å–Ω–∏–π —Ç–æ–Ω
- –ü–æ–≤–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç

**–°–ø–∞–º (medium)**:
- –°–∫–æ—Ä–æ—á–µ–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å (100 —Å–∏–º–≤–æ–ª—ñ–≤) 
- –°—Ç–∏–ª—å `concise`
- –ó–º–µ–Ω—à–µ–Ω–∏–π —à–∞–Ω—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –≤ 3 —Ä–∞–∑–∏

**–°–ø–∞–º (high)**:
- –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å (50 —Å–∏–º–≤–æ–ª—ñ–≤)
- –°—Ç–∏–ª—å `minimal`  
- –ó–º–µ–Ω—à–µ–Ω–∏–π —à–∞–Ω—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –≤ 10 —Ä–∞–∑—ñ–≤
- –ú–æ–∂–ª–∏–≤—ñ –∞–Ω—Ç–∏-—Å–ø–∞–º –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

**–ü–æ–≥–∞–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç**:
- –¢–æ–Ω `–Ω–∞–ø—Ä–∞–≤–ª—è—é—á–∏–π_–∂–∞—Ä—Ç`
- –ó–∞–ø–∏—Ç–∏ –Ω–∞ —É—Ç–æ—á–Ω–µ–Ω–Ω—è
- –°–ø—Ä–æ–±–∏ –Ω–∞–ø—Ä–∞–≤–∏—Ç–∏ —Ä–æ–∑–º–æ–≤—É

## –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

### –ù–æ–≤—ñ –∑–º—ñ–Ω–Ω—ñ .env:
```env
# –ö–æ–Ω—Ç—Ä–æ–ª—å —Å–ø–∞–º—É  
BOT_SPAM_THRESHOLD=5          # –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å/—Ö–≤ –¥–ª—è —Å–ø–∞–º—É
BOT_SMART_REPLY_CHANCE=0.05   # –ë–∞–∑–æ–≤–∏–π —à–∞–Ω—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ

# –ö–æ–Ω—Ç–µ–∫—Å—Ç
BOT_CONTEXT_LIMIT=100         # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–º—ñ—Ä
```

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –í–∏–∫–æ–Ω–∞–Ω—ñ —Ç–µ—Å—Ç–∏:
1. ‚úÖ `test_smart_context.py` - –û—Å–Ω–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å
2. ‚úÖ `test_integration.py` - –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –º–æ–¥—É–ª—ñ–≤  
3. ‚úÖ –ì—Ä–∞–Ω–∏—á–Ω—ñ –≤–∏–ø–∞–¥–∫–∏ —Å—Ç–∏—Å–Ω–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
4. ‚úÖ –í–∏—è–≤–ª–µ–Ω–Ω—è —Ä—ñ–∑–Ω–∏—Ö —Ä—ñ–≤–Ω—ñ–≤ —Å–ø–∞–º—É
5. ‚úÖ –ê–¥–∞–ø—Ç–∞—Ü—ñ—è —Ç–æ–Ω—É —Ç–∞ —Å—Ç–∏–ª—é

## –ü–µ—Ä–µ–≤–∞–≥–∏ —Å–∏—Å—Ç–µ–º–∏

### üéØ –†–æ–∑—É–º–Ω–∏–π –∞–Ω—Ç–∏-—Å–ø–∞–º
- –ù–µ –±–ª–æ–∫—É—î –ø–æ–≤–Ω—ñ—Å—Ç—é, –∞ –∞–¥–∞–ø—Ç—É—î –ø–æ–≤–µ–¥—ñ–Ω–∫—É
- –ó–±–µ—Ä—ñ–≥–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–∞ –ø—Ä—è–º—ñ –∑–≥–∞–¥–∫–∏
- –ú'—è–∫—ñ –∞–Ω—Ç–∏-—Å–ø–∞–º –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

### üß† –ö–æ–Ω—Ç–µ–∫—Å—Ç-–∞–≤–∞—Ä–Ω—ñ—Å—Ç—å
- –ó–±–µ—Ä—ñ–≥–∞—î –≤–∞–∂–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–∏ —Å—Ç–∏—Å–Ω–µ–Ω–Ω—ñ
- –ê–Ω–∞–ª—ñ–∑—É—î —è–∫—ñ—Å—Ç—å —Ä–æ–∑–º–æ–≤–∏
- –ê–¥–∞–ø—Ç—É—î —Ç–æ–Ω –¥–æ —Å–∏—Ç—É–∞—Ü—ñ—ó

### ‚ö° –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ—á–∏—â–µ–Ω–Ω—è —Å—Ç–∞—Ä–∏—Ö –¥–∞–Ω–∏—Ö
- –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π —Ä–æ–∑–º—ñ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
- –ö–µ—à—É–≤–∞–Ω–Ω—è –∞–Ω–∞–ª—ñ–∑—É

### üîß –ì–Ω—É—á–∫—ñ—Å—Ç—å
- –ù–∞–ª–∞—à—Ç–æ–≤—É–≤–∞–Ω—ñ –ø–æ—Ä–æ–≥–∏ —Å–ø–∞–º—É
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó
- –ú–æ–¥—É–ª—å–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

## –†–µ–∑—É–ª—å—Ç–∞—Ç

–°–∏—Å—Ç–µ–º–∞ **–ø–æ–≤–Ω—ñ—Å—Ç—é –≥–æ—Ç–æ–≤–∞** –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ç–∞ **—É—Å–ø—ñ—à–Ω–æ —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–∞**:

- ‚úÖ –ó–∞–ø–æ–±—ñ–≥–∞—î —Å–ø–∞–º—É —Ç–∞ –Ω–æ–Ω—Å–µ–Ω—Å—É –≤—ñ–¥ –±–æ—Ç–∞
- ‚úÖ –†–æ–∑—É–º–Ω–æ –æ–±—Ä–æ–±–ª—è—î –∫–æ–Ω—Ç–µ–∫—Å—Ç —á–∞—Ç—É
- ‚úÖ –ê–¥–∞–ø—Ç—É—î –ø–æ–≤–µ–¥—ñ–Ω–∫—É –¥–æ —Å–∏—Ç—É–∞—Ü—ñ—ó
- ‚úÖ –ó–±–µ—Ä—ñ–≥–∞—î –≤–∞–∂–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é
- ‚úÖ –ü—ñ–¥—Ç—Ä–∏–º—É—î –≤—Å—ñ —ñ—Å–Ω—É—é—á—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
- ‚úÖ –ü–æ–∫—Ä–∏—Ç–∞ —Ç–µ—Å—Ç–∞–º–∏

**–ë–æ—Ç —Ç–µ–ø–µ—Ä –Ω–∞–±–∞–≥–∞—Ç–æ —Ä–æ–∑—É–º–Ω—ñ—à–∏–π —É –≥—Ä—É–ø–æ–≤–æ–º—É —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—ñ!** üéâ
